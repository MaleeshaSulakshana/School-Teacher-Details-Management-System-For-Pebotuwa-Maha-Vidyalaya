{% extends 'base.html' %}
{% block content %}

{% if details %}

<div class="content-wrapper">

  <div class="row">
    <div class="col-12 grid-margin stretch-card">
      <div class="card">
        <div class="card-body">
          <h4 class="card-title" id="teacher-title">Teacher information's</h4>

          <form class="forms-sample">
            
            <div id="teacher-Details">

              <div class="form-group">
                <label for="fullname">Teacher Full Name</label>
                <textarea class="form-control" id="fullname" rows="4">{{ details[0] }}</textarea>
              </div>
              
              <div class="form-group">
                <label for="fullnameinitials">Full Name with Initials</label>
                <textarea class="form-control" id="fullnameinitials" rows="4">{{ details[1] }}</textarea>
              </div>
  
              <div class="form-group">
                <label for="dob">Date of Birth</label>
                <input type="date" class="form-control" id="dob" value="{{ details[2] }}">
              </div>
  
              <div class="form-group">
                <label for="nic">NIC Number</label>
                <input type="text" class="form-control" id="nic" value="{{ details[3] }}">
              </div>
  
              <div class="form-group">
                <label for="address">Private Address</label>
                <textarea class="form-control" id="address" rows="4">{{ details[4] }}</textarea>
              </div>
  
              <div class="form-group">
                <label for="distance">Distance of Home to Service Place</label>
                <input type="text" class="form-control" id="distance" value="{{ details[5] }}">
              </div>
  
              <div class="form-group">
                <label for="">Telephone Numbers</label>
                <input type="text" class="form-control" id="landnumber" value="{{ details[6] }}">
                <br/>
                <input type="text" class="form-control" id="mobilenumber" value="{{ details[7] }}">
              </div>
  
              <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" class="form-control" id="email" value="{{ details[8] }}">
              </div>
  
              <div class="form-group">
                <label for="marriedpersonname">Married Person's Name</label>
                <textarea class="form-control" id="marriedpersonname" rows="4">{{ details[9] }}</textarea>
              </div>
  
              <div class="form-group">
                <label for="marriedpersonjob">Married Person's Job and Service Place</label>
                <textarea class="form-control" id="marriedpersonjob" rows="4">{{ details[10] }}</textarea>
              </div>
  
              <div class="form-group">
                <label for="originalappointment">Date of Original Appointment</label>
                <input type="date" class="form-control" id="originalappointment" value="{{ details[11] }}">
              </div>
  
              <div class="form-group">
                <label for="gradeclass">Teacher/Principal Grade and Class</label>
                <input type="text" class="form-control" id="gradeclass" value="{{ details[12] }}">
              </div>
  
              <div class="form-group">
                <label for="salaryimplementdate">Salary Implement Date</label>
                <input type="text" class="form-control" id="salaryimplementdate" value="{{ details[13] }}">
              </div>
  
              <div class="form-group">
                <label for="servicedschools">Previous Serviced Schools</label>
                <textarea class="form-control" id="servicedschools" rows="5">{{ details[14] }}</textarea>
              </div>
  
              <div class="form-group">
                <label for="educationqualifications">Education Qualifications</label>
                <textarea class="form-control" id="educationqualifications" rows="5">{{ details[15] }}</textarea>
              </div>

              <div class="form-group">
                <h4 for="">Ordinary Level</h4>
              </div>
  
              <div class="form-group">
                <label for="olyear">Ordinary Level Year</label>
                <input type="text" class="form-control" id="olyear" value="{{ details[18] }}">
              </div>
  
              <div class="form-group">
                <label for="">Ordinary Level Subjects</label>
  
                <div class="form-group row">
                  <div class="col">
                    <div class="form-group">
                      <textarea class="form-control" id="ol1" rows="1">{{ details[19] }}</textarea>
                    </div>
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <textarea class="form-control" id="ol6" rows="1">{{ details[20] }}</textarea>
                    </div>
                  </div>
                </div>
  
                <div class="form-group row">
                  <div class="col">
                    <div class="form-group">
                      <textarea class="form-control" id="ol2" rows="1">{{ details[21] }}</textarea>
                    </div>
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <textarea class="form-control" id="ol7" rows="1">{{ details[22] }}</textarea>
                    </div>
                  </div>
                </div>
  
                <div class="form-group row">
                  <div class="col">
                    <div class="form-group">
                      <textarea class="form-control" id="ol3" rows="1">{{ details[23] }}</textarea>
                    </div>
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <textarea class="form-control" id="ol8" rows="1">{{ details[24] }}</textarea>
                    </div>
                  </div>
                </div>
  
                <div class="form-group row">
                  <div class="col">
                    <div class="form-group">
                      <textarea class="form-control" id="ol4" rows="1">{{ details[25] }}</textarea>
                    </div>
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <textarea class="form-control" id="ol9" rows="1">{{ details[26] }}</textarea>
                    </div>
                  </div>
                </div>
  
                <div class="form-group row">
                  <div class="col">
                    <div class="form-group">
                      <textarea class="form-control" id="ol5" rows="1">{{ details[27] }}</textarea>
                    </div>
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <textarea class="form-control" id="ol10" rows="1">{{ details[28] }}</textarea>
                    </div>
                  </div>
                </div>
  
              </div>
  
              <div class="form-group">
                <h4 for="">Advanced Level</h4>
              </div>
  
              <div class="form-group">
                <label for="alstream">Advanced Level Subject Stream</label>
                <textarea class="form-control" id="alstream" rows="1">{{ details[29] }}</textarea>
              </div>
  
              <div class="form-group">
                <label for="alyear">Advanced Level Year</label>
                <input type="text" class="form-control" id="alyear" value="{{ details[30] }}">
              </div>
  
              <div class="form-group">
                <label for="">Advance Level Subjects</label>
  
                <div class="form-group row">
                  <div class="col">
                    <div class="form-group">
                      <textarea class="form-control" id="al1" rows="1">{{ details[31] }}</textarea>
                    </div>
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <textarea class="form-control" id="al3" rows="1">{{ details[32] }}</textarea>
                    </div>
                  </div>
                </div>
  
                <div class="form-group row">
                  <div class="col">
                    <div class="form-group">
                      <textarea class="form-control" id="al2" rows="1">{{ details[33] }}</textarea>
                    </div>
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <textarea class="form-control" id="al4" rows="1">{{ details[34] }}</textarea>
                    </div>
                  </div>
                </div>
  
              </div>
  
              <div class="form-group">
                <label for="isdegree">Is Degree Have?</label>
                <select class="form-control" id="isdegree">
                  <option value="Yes"
                  {% if details[35] == 'Yes' %}
                  selected
                  {% endif %}
                  >Yes</option>
                  <option value="No"
                  {% if details[35] == 'No' %}
                  selected
                  {% endif %}
                  >No</option>
                </select>
              </div>
  
              <div class="form-group">
                <label for="degreename">Degree Name</label>
                <textarea class="form-control" id="degreename" rows="5">{{ details[36] }}</textarea>
              </div>
  
              <div class="form-group">
                <label for="">Subjects Studied in The Degree</label>
  
                <div class="form-group row">
                  <div class="col">
                    <div class="form-group">
                      <textarea class="form-control" id="d1" rows="1">{{ details[37] }}</textarea>
                    </div>
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <textarea class="form-control" id="d4" rows="1">{{ details[38] }}</textarea>
                    </div>
                  </div>
                </div>
  
                <div class="form-group row">
                  <div class="col">
                    <div class="form-group">
                      <textarea class="form-control" id="d2" rows="1">{{ details[39] }}</textarea>
                    </div>
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <textarea class="form-control" id="d5" rows="1">{{ details[40] }}</textarea>
                    </div>
                  </div>
                </div>
  
                <div class="form-group row">
                  <div class="col">
                    <div class="form-group">
                      <textarea class="form-control" id="d3" rows="1">{{ details[41] }}</textarea>
                    </div>
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <textarea class="form-control" id="d6" rows="1">{{ details[42] }}</textarea>
                    </div>
                  </div>
                </div>
  
              </div>
  
              <div class="form-group">
                <label for="professionalqualifications">Professional Qualifications</label>
                <textarea class="form-control" id="professionalqualifications" rows="5">{{ details[43] }}</textarea>
              </div>
  
              <div class="form-group">
                <label for="datetransfer">Date of Transfer</label>
                <input type="text" class="form-control" id="datetransfer" value="{{ details[44] }}">
              </div>
              
              <div class="form-group">
                <label for="placeoftransfer">Place of Transfer</label>
                <textarea class="form-control" id="placeoftransfer" rows="5">{{ details[45] }}</textarea>
              </div>
  
              <div class="form-group">
                <label for="otherinformations">Other Information</label>
                <textarea class="form-control" id="otherinformations" rows="5">{{ details[46] }}</textarea>
              </div>
  
              <div class="form-group">
                <label for="datefilled">Date</label>
                <input type="text" class="form-control" id="datefilled" value="{{ details[47] }}">
              </div>

              <div class="form-group">
                <label for="insetedby">Inserted By</label>
                <input type="text" class="form-control" id="insetedby" value="{{ details[48] }}" disabled>
              </div>

              <div class="form-group">
                <label for="updatedby">Updated By</label>
                <input type="text" class="form-control" id="updatedby" value="{{ details[49] }}" disabled>
              </div>

            </div>

            {% if details[17] == 0 %}
            <button type="button" id="edit" class="btn btn-primary mr-2">Edit (සංස්කරණය කරන්න)</button>
            <button type="button" id="update" onclick="updateValues('{{ details[16] }}')" class="btn btn-primary mr-2">Update (යාවත්කාලීන කරන්න)</button>
            <button type="button" id="deactivate" onclick="setStatus('{{ details[16] }}', '1')" class="btn btn-danger mr-2">Deactivate (අක්‍රිය කරන්න)</button>
            {% else %}
            <button type="button" id="activate" onclick="setStatus('{{ details[16] }}', '0')" class="btn btn-primary mr-2">Active (ක්රියාකාරී කරන්න)</button>
            {% endif %}
            {% if session['type'] == '1' %}
            <button type="button" id="delete" onclick="deleteValue('{{ details[16] }}')" class="btn btn-danger mr-2">Delete (මකන්න)</button>
            {% endif %}
            <a href="/" class="btn btn-light">Cancel (ඉවත් වන්න)</a>
            <button type="button" id="print" onclick="downloadReceptPdf('{{ details[1] }}')" class="btn btn-success mr-2">Print (මුද්‍රණය කරන්න)</button>
          </form>
        </div>
      </div>
    </div>
  </div>

</div>

<script>

  $(window).on('load', function(){
    
    fieldsDisable(true);

    $('#edit').show();
    $('#update').hide();
    $('#deactivate').show();
    $('#print').show();

  });

  $(function () {
      $('#edit').click(function () {

        fieldsDisable(false);
        $('#edit').hide();
        $('#update').show();
        $('#print').hide();

      })
  })

  function fieldsDisable(type) {
    $("#fullname").prop('disabled', type);
    $("#fullnameinitials").prop('disabled', type);
    $("#dob").prop('disabled', type);
    $("#nic").prop('disabled', type);
    $("#address").prop('disabled', type);
    $("#distance").prop('disabled', type);
    $("#landnumber").prop('disabled', type);
    $("#mobilenumber").prop('disabled', type);
    $("#email").prop('disabled', type);
    $("#marriedpersonname").prop('disabled', type);
    $("#marriedpersonjob").prop('disabled', type);
    $("#originalappointment").prop('disabled', type);
    $("#gradeclass").prop('disabled', type);
    $("#salaryimplementdate").prop('disabled', type);
    $("#servicedschools").prop('disabled', type);
    $("#educationqualifications").prop('disabled', type);

    $("#olyear").prop('disabled', type);
    $("#ol1").prop('disabled', type);
    $("#ol6").prop('disabled', type);
    $("#ol2").prop('disabled', type);
    $("#ol7").prop('disabled', type);
    $("#ol3").prop('disabled', type);
    $("#ol8").prop('disabled', type);
    $("#ol4").prop('disabled', type);
    $("#ol9").prop('disabled', type);
    $("#ol5").prop('disabled', type);
    $("#ol10").prop('disabled', type);
    $("#alstream").prop('disabled', type);
    $("#alyear").prop('disabled', type);
    $("#al1").prop('disabled', type);
    $("#al3").prop('disabled', type);
    $("#al2").prop('disabled', type);
    $("#al4").prop('disabled', type);
    $("#isdegree").prop('disabled', type);
    $("#degreename").prop('disabled', type);
    $("#d1").prop('disabled', type);
    $("#d4").prop('disabled', type);
    $("#d2").prop('disabled', type);
    $("#d5").prop('disabled', type);
    $("#d3").prop('disabled', type);
    $("#d6").prop('disabled', type);
    $("#professionalqualifications").prop('disabled', type);
    $("#datetransfer").prop('disabled', type);
    $("#placeoftransfer").prop('disabled', type);
    $("#otherinformations").prop('disabled', type);
    $("#datefilled").prop('disabled', type);
  }

  function updateValues(idValue) {

    Swal.fire({
          icon: 'question',
          title: "Do you want update teacher information's? (ඔබට ගුරු තොරතුරු යාවත්කාලීන කිරීමට අවශ්‍යද?)",
          showDenyButton: true,
          showCancelButton: false,
          confirmButtonText: 'Yes (ඔව්)',
          denyButtonText: 'No (නැත)',
        }).then((result) => {
          
          if (result.isConfirmed) {

            var id = idValue;
            var fullName = $('#fullname').val();
            var fullNameInitials = $('#fullnameinitials').val();
            var dob = $('#dob').val();
            var nic = $('#nic').val();
            var address = $('#address').val();
            var distance = $('#distance').val();
            var landNumber = $('#landnumber').val();
            var mobileNumber = $('#mobilenumber').val();
            var email = $('#email').val();
            var marriedPersonName = $('#marriedpersonname').val();
            var marriedPersonJob = $('#marriedpersonjob').val();
            var originalAppointment = $('#originalappointment').val();
            var gradeClass = $('#gradeclass').val();
            var salaryImplementDate = $('#salaryimplementdate').val();
            var servicedSchools = $('#servicedschools').val();
            var educationQualifications = $('#educationqualifications').val();

            var olyear = $('#olyear').val();
            var ol1 = $('#ol1').val();
            var ol6 = $('#ol6').val();
            var ol2 = $('#ol2').val();
            var ol7 = $('#ol7').val();
            var ol3 = $('#ol3').val();
            var ol8 = $('#ol8').val();
            var ol4 = $('#ol4').val();
            var ol9 = $('#ol9').val();
            var ol5 = $('#ol5').val();
            var ol10 = $('#ol10').val();
            var alstream = $('#alstream').val();
            var alyear = $('#alyear').val();
            var al1 = $('#al1').val();
            var al3 = $('#al3').val();
            var al2 = $('#al2').val();
            var al4 = $('#al4').val();
            var isdegree = $('#isdegree').val();
            var degreename = $('#degreename').val();
            var d1 = $('#d1').val();
            var d4 = $('#d4').val();
            var d2 = $('#d2').val();
            var d5 = $('#d5').val();
            var d3 = $('#d3').val();
            var d6 = $('#d6').val();
            var professionalqualifications = $('#professionalqualifications').val();
            var datetransfer = $('#datetransfer').val();
            var placeoftransfer = $('#placeoftransfer').val();
            var otherinformations = $('#otherinformations').val();
            var datefilled = $('#datefilled').val();

            var title = "Update Teacher Information (ගුරු තොරතුරු යාවත්කාලීන කරන්න)";

            if (id == "" || fullName == "" || fullNameInitials == "" || dob == "" || nic == "" || address == "" || distance == "" || educationQualifications == "") {
              swal.fire(title, "Fields are empty! (ආදාන ක්ෂේත්‍ර හිස්ය!)", "warning");

            } else {

              var form_data = new FormData();
              form_data.append('id', id);
              form_data.append('fullName', fullName);
              form_data.append('fullNameInitials', fullNameInitials);
              form_data.append('dob', dob);
              form_data.append('nic', nic);
              form_data.append('address', address);
              form_data.append('distance', distance);
              form_data.append('landNumber', landNumber);
              form_data.append('mobileNumber', mobileNumber);
              form_data.append('email', email);
              form_data.append('marriedPersonName', marriedPersonName);
              form_data.append('marriedPersonJob', marriedPersonJob);
              form_data.append('originalAppointment', originalAppointment);
              form_data.append('gradeClass', gradeClass);
              form_data.append('salaryImplementDate', salaryImplementDate);
              form_data.append('servicedSchools', servicedSchools);
              form_data.append('educationQualifications', educationQualifications);

              form_data.append('olYear', olyear);
              form_data.append('ol1', ol1);
              form_data.append('ol6', ol6);
              form_data.append('ol2', ol2);
              form_data.append('ol7', ol7);
              form_data.append('ol3', ol3);
              form_data.append('ol8', ol8);
              form_data.append('ol4', ol4);
              form_data.append('ol9', ol9);
              form_data.append('ol5', ol5);
              form_data.append('ol10', ol10);
              form_data.append('alStream', alstream);
              form_data.append('alYear', alyear);
              form_data.append('al1', al1);
              form_data.append('al3', al3);
              form_data.append('al2', al2);
              form_data.append('al4', al4);
              form_data.append('isDegree', isdegree);
              form_data.append('degreeName', degreename);
              form_data.append('d1', d1);
              form_data.append('d4', d4);
              form_data.append('d2', d2);
              form_data.append('d5', d5);
              form_data.append('d3', d3);
              form_data.append('d6', d6);
              form_data.append('professionalQualifications', professionalqualifications);
              form_data.append('dateTransfer', datetransfer);
              form_data.append('placeOfTransfer', placeoftransfer);
              form_data.append('otherInformations', otherinformations);
              form_data.append('dateFilled', datefilled);

              $.ajax({
                url: "/update_teacher",
                enctype: 'multipart/form-data',
                data: form_data,
                contentType: false,
                cache: false,
                processData: false,
                type: 'POST',
              })
                .done(function (data) {
                  if (data.redirect) {
                    window.location.href = data.redirect;
                  }
                  else if (data.success) {
                    Swal.fire(title, data.success, "success");

                    fieldsDisable(true);
                    $('#edit').show();
                    $('#update').hide();
                    $('#deactivate').show();
                    $('#print').show();
                  }
                  else if (data.error) {
                    Swal.fire(title, data.error, "warning");
                  }
                  else {
                    Swal.fire(title, "Some error occur! (යම් දෝෂයක් සිදු වේ!)", "warning");
                  }
                });

            }

          } else if (result.isDenied) {
            Swal.hide();
          }
        })

      event.preventDefault();
    };

    function setStatus(idValue, setstatus) {

      Swal.fire({
          icon: 'question',
          title: 'Do you want update teacher status? (ඔබට ගුරු තත්ත්වය යාවත්කාලීන කිරීමට අවශ්‍යද?)',
          showDenyButton: true,
          showCancelButton: false,
          confirmButtonText: 'Yes (ඔව්)',
          denyButtonText: 'No (නැත)',
        }).then((result) => {
          
          if (result.isConfirmed) {
            
            var id = idValue;
            var status = setstatus;

            var title = "Change Teacher Information Status (ගුරු තොරතුරු තත්ත්වය වෙනස් කරන්න)";

            if (id == "" || setstatus == "") {
              swal.fire(title, "Fields are empty! (ආදාන ක්ෂේත්‍ර හිස්ය!)", "warning");

            } else {

              var form_data = new FormData();
              form_data.append('id', id);
              form_data.append('status', status);

              $.ajax({
                url: "/change_status",
                enctype: 'multipart/form-data',
                data: form_data,
                contentType: false,
                cache: false,
                processData: false,
                type: 'POST',
              })
                .done(function (data) {
                  if (data.redirect) {
                    window.location.href = data.redirect;
                  }
                  else if (data.success) {
                    Swal.fire(title, data.success, "success");

                    window.location.reload();
                  }
                  else if (data.error) {
                    Swal.fire(title, data.error, "warning");
                  }
                  else {
                    Swal.fire(title, "Some error occur! (යම් දෝෂයක් සිදු වේ!)", "warning");
                  }
                });

              }

          } else if (result.isDenied) {
            Swal.hide();
          }
        })

        event.preventDefault();
    };

    
    function deleteValue(idValue) {

      Swal.fire({
          icon: 'question',
          title: 'Do you want delete teacher informations? (ඔබට ගුරු තොරතුරු මකා දැමීමට අවශ්‍යද?)',
          showDenyButton: true,
          showCancelButton: false,
          confirmButtonText: 'Yes (ඔව්)',
          denyButtonText: 'No (නැත)',
        }).then((result) => {
          
          if (result.isConfirmed) {
            
            var id = idValue;
            var title = "Delete Teacher Information (ගුරු තොරතුරු මකන්න)";

            if (id == "") {
              swal.fire(title, "Fields are empty! (ආදාන ක්ෂේත්‍ර හිස්ය!)", "warning");

            } else {

              var form_data = new FormData();
              form_data.append('id', id);

              $.ajax({
                url: "/remove_teacher",
                enctype: 'multipart/form-data',
                data: form_data,
                contentType: false,
                cache: false,
                processData: false,
                type: 'POST',
              })
                .done(function (data) {
                  if (data.redirect) {
                    window.location.href = data.redirect;
                  }
                  else if (data.success) {
                    Swal.fire(title, data.success, "success");
                    window.location.href = "/";
                  }
                  else if (data.error) {
                    Swal.fire(title, data.error, "warning");
                  }
                  else {
                    Swal.fire(title, "Some error occur! (යම් දෝෂයක් සිදු වේ!)", "warning");
                  }
                });

              }

          } else if (result.isDenied) {
            Swal.hide();
          }
        })

        event.preventDefault();
      };


    function downloadReceptPdf(fileName) {

      var pdf_content = document.getElementById("teacher-title");
      var pdf_body = document.getElementById("teacher-Details");

      pdf_content.append(pdf_body)

      var options = {
        margin: 1,
        filename: fileName + '.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }

      };

      html2pdf(pdf_content, options);

      }

</script>

{% endif %}

{% endblock %}